<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Expense_Flow.Views.Shell.ShellPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:animatedvisuals="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Grid x:Name="AppTitleBar" 
              Grid.Row="0"
              Background="Transparent"
              Height="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Left: App Logo and Title -->
            <StackPanel Grid.Column="0" 
                       Orientation="Horizontal" 
                       Spacing="12" 
                       Padding="16,0,0,0"
                       VerticalAlignment="Center">
                <Border Background="{StaticResource PrimaryGradientBrush}"
                      Width="32" Height="32"
                      CornerRadius="8">
                    <FontIcon Glyph="&#xE8C7;" 
                            Foreground="White"
                            FontSize="16"/>
                </Border>
                <TextBlock Text="Expense Flow"
                         FontSize="13"
                         FontWeight="SemiBold"
                         VerticalAlignment="Center"/>
                <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                      CornerRadius="4"
                      Padding="8,2"
                      VerticalAlignment="Center">
                    <TextBlock x:Name="OrgNameText"
                             Text="Personal"
                             FontSize="11"
                             Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                             VerticalAlignment="Center"/>
                </Border>
            </StackPanel>

            <!-- Right: User Profile -->
            <StackPanel Grid.Column="2" 
                       Orientation="Horizontal" 
                       Spacing="8"
                       Padding="0,0,140,0"
                       VerticalAlignment="Center">
                <!-- User Profile Button with Flyout -->
                <Button x:Name="UserProfileButton"
                       Style="{StaticResource IconButtonStyle}"
                       Width="36" Height="36"
                       Padding="0">
                    <Button.Flyout>
                        <Flyout Placement="BottomEdgeAlignedRight">
                            <StackPanel Width="280" Spacing="12">
                                <!-- User Info Header -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <PersonPicture Grid.Column="0"
                                                 x:Name="ProfilePictureLarge"
                                                 Width="48" Height="48"
                                                 Margin="0,0,12,0"/>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock x:Name="UserDisplayNameText"
                                                 Text="Loading..."
                                                 FontSize="14"
                                                 FontWeight="SemiBold"
                                                 TextTrimming="CharacterEllipsis"/>
                                        <TextBlock x:Name="UserEmailText"
                                                 Text=""
                                                 FontSize="12"
                                                 Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                 TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </Grid>

                                <MenuFlyoutSeparator/>

                                <!-- Menu Items -->
                                <StackPanel Spacing="4">
                                    <Button Click="ViewProfile_Click"
                                          HorizontalAlignment="Stretch"
                                          Style="{StaticResource SubtleButtonStyle}">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <FontIcon Glyph="&#xE77B;" FontSize="16"/>
                                            <TextBlock Text="View Profile"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Click="Settings_Click"
                                          HorizontalAlignment="Stretch"
                                          Style="{StaticResource SubtleButtonStyle}">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <FontIcon Glyph="&#xE713;" FontSize="16"/>
                                            <TextBlock Text="Settings"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Click="Help_Click"
                                          HorizontalAlignment="Stretch"
                                          Style="{StaticResource SubtleButtonStyle}">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <FontIcon Glyph="&#xE897;" FontSize="16"/>
                                            <TextBlock Text="Help &amp; Feedback"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Click="About_Click"
                                          HorizontalAlignment="Stretch"
                                          Style="{StaticResource SubtleButtonStyle}">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <FontIcon Glyph="&#xE946;" FontSize="16"/>
                                            <TextBlock Text="About Expense Flow"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                    <PersonPicture x:Name="ProfilePictureSmall"
                                 Width="28" Height="28"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Main Navigation View (Compact) -->
        <NavigationView
            x:Name="MainNavigationView"
            Grid.Row="1"
            IsBackButtonVisible="Collapsed"
            IsSettingsVisible="False"
            PaneDisplayMode="Left"
            IsPaneToggleButtonVisible="False"
            CompactPaneLength="110"
            OpenPaneLength="110"
            SelectionChanged="NavigationView_SelectionChanged"
            Loaded="NavigationView_Loaded">

            <NavigationView.Resources>
                <!-- Transparent Navigation Pane Background -->
                <SolidColorBrush x:Key="NavigationViewDefaultPaneBackground" Color="Transparent"/>
                <SolidColorBrush x:Key="NavigationViewExpandedPaneBackground" Color="Transparent"/>
                
                <!-- Selected item with primary color -->
                <SolidColorBrush x:Key="NavigationViewSelectionIndicatorForeground" 
                               Color="{StaticResource PrimaryColor}"/>
                
                <!-- Navigation Item Styling for better spacing -->
                <Style TargetType="NavigationViewItem">
                    <Setter Property="MinHeight" Value="56"/>
                    <Setter Property="Height" Value="Auto"/>
                    <Setter Property="Padding" Value="0,6,0,6"/>
                    <Setter Property="Margin" Value="2,2"/>
                </Style>
                
                <!-- Custom style for FontIcon in NavigationViewItem content -->
                <Style x:Key="NavIconStyle" TargetType="FontIcon">
                    <Setter Property="FontSize" Value="20"/>
                    <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
                </Style>
                
                <!-- Custom style for selected nav icon -->
                <Style x:Key="NavIconSelectedStyle" TargetType="FontIcon">
                    <Setter Property="FontSize" Value="20"/>
                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                </Style>
                
                <Style TargetType="NavigationViewItemSeparator">
                    <Setter Property="Margin" Value="16,4,16,4"/>
                </Style>
            </NavigationView.Resources>

            <NavigationView.MenuItems>
                <!-- Dashboard -->
                <NavigationViewItem Tag="Dashboard" ToolTipService.ToolTip="Dashboard">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE80F;" FontSize="20"/>
                            <TextBlock Text="Dashboard" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <!-- Expenses -->
                <NavigationViewItem Tag="Expenses" ToolTipService.ToolTip="Expenses">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE8C7;" FontSize="20"/>
                            <TextBlock Text="Expenses" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <!-- Projects -->
                <NavigationViewItem Tag="Projects" ToolTipService.ToolTip="Projects">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE8F1;" FontSize="20"/>
                            <TextBlock Text="Projects" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <NavigationViewItemSeparator/>

                <!-- Contacts -->
                <NavigationViewItem Tag="Contacts" ToolTipService.ToolTip="Contacts">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE716;" FontSize="20"/>
                            <TextBlock Text="Contacts" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <!-- Payment Modes -->
                <NavigationViewItem Tag="PaymentModes" ToolTipService.ToolTip="Payment Modes">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE8C7;" FontSize="20"/>
                            <TextBlock Text="Payments" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <!-- Subscriptions -->
                <NavigationViewItem Tag="Subscriptions" ToolTipService.ToolTip="Subscriptions">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE910;" FontSize="20"/>
                            <TextBlock Text="Subscriptions" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <!-- Vendors -->
                <NavigationViewItem Tag="Vendors" ToolTipService.ToolTip="Vendors">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE731;" FontSize="20"/>
                            <TextBlock Text="Vendors" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <NavigationViewItemSeparator/>

                <!-- Settlements -->
                <NavigationViewItem Tag="Settlements" ToolTipService.ToolTip="Settlements &amp; Reimbursements">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE8B1;" FontSize="20"/>
                            <TextBlock Text="Settlements" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>

                <!-- Reports -->
                <NavigationViewItem Tag="Reports" ToolTipService.ToolTip="Reports">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xE9D9;" FontSize="20"/>
                            <TextBlock Text="Reports" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
            </NavigationView.MenuItems>

            <NavigationView.FooterMenuItems>
                <!-- What's New -->
                <NavigationViewItem Tag="WhatsNew" ToolTipService.ToolTip="What's New">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <FontIcon Glyph="&#xEA8F;" FontSize="20"/>
                            <TextBlock Text="What's New" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
                
                <!-- Settings with AnimatedIcon -->
                <NavigationViewItem Tag="Settings" ToolTipService.ToolTip="Settings">
                    <NavigationViewItem.Content>
                        <StackPanel HorizontalAlignment="Center" 
                                  Spacing="4"
                                  Padding="2">
                            <AnimatedIcon x:Name="SettingsAnimatedIcon" 
                                        Width="20" Height="20"
                                        HorizontalAlignment="Center">
                                <AnimatedIcon.Source>
                                    <animatedvisuals:AnimatedSettingsVisualSource />
                                </AnimatedIcon.Source>
                                <AnimatedIcon.FallbackIconSource>
                                    <FontIconSource Glyph="&#xE713;"/>
                                </AnimatedIcon.FallbackIconSource>
                            </AnimatedIcon>
                            <TextBlock Text="Settings" 
                                     FontSize="10" 
                                     TextAlignment="Center"
                                     TextTrimming="CharacterEllipsis"
                                     MaxLines="1"
                                     MaxWidth="100"/>
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
            </NavigationView.FooterMenuItems>

            <!-- Content Frame with smooth transitions -->
            <Frame x:Name="ContentFrame" Padding="0">
                <Frame.ContentTransitions>
                    <TransitionCollection>
                        <NavigationThemeTransition>
                            <NavigationThemeTransition.DefaultNavigationTransitionInfo>
                                <EntranceNavigationTransitionInfo/>
                            </NavigationThemeTransition.DefaultNavigationTransitionInfo>
                        </NavigationThemeTransition>
                    </TransitionCollection>
                </Frame.ContentTransitions>
            </Frame>

        </NavigationView>
    </Grid>
</Page>
